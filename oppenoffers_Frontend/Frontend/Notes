[NEW TABLE ANNOUNCES] DIRHA FI SQL HADI SQLSERVER

CREATE TABLE ANNOUNCES (
    Id_Operation uniqueidentifier NOT NULL,
    Numero nvarchar(255) NOT NULL,
    Date_Publication date NOT NULL,
    Journal nvarchar(255) NOT NULL,
    Delai int NOT NULL,
    Heure_Ouverture time(7) NOT NULL,
    Date_Overture date NOT NULL,
    Status tinyint NOT NULL,
    adminId uniqueidentifier NOT NULL,
    
    -- Primary Key
    CONSTRAINT PK_ANNOUNCES PRIMARY KEY (Id_Operation),
    
    -- Unique Constraint for Numero
    CONSTRAINT UQ_ANNOUNCES_Numero UNIQUE (Numero),
    
    -- Foreign Key Constraint
    CONSTRAINT FK_ANNOUNCES_adminId FOREIGN KEY (adminId) 
        REFERENCES [ADMINS](id), 
    
);

-- Create Index on adminId (Foreign Key column)
CREATE INDEX IX_ANNOUNCES_adminId ON ANNOUNCES (adminId);

-- Additional index suggestions (optional but recommended):
CREATE INDEX IX_ANNOUNCES_DateOverture ON ANNOUNCES (Date_Overture);
CREATE INDEX IX_ANNOUNCES_Status ON ANNOUNCES (Status);



[PROCEDURE STOCKE ADD ANNOUNCES] Hada procedure stocke jdid SQLSERVER VERSION
USE [PlisFlow]
GO
/****** Object:  StoredProcedure [dbo].[insertNewANNONCE]    Script Date: 2025-12-27 1:00:39 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

ALTER PROCEDURE [dbo].[insertNewANNONCE]
    @aId_Operation UNIQUEIDENTIFIER,
    @aNumero varchar(10),
    @aDate_Publication DATE,
    @aJournal VARCHAR(100),
    @aDelai int,
	@aHeure_Ouverture TIME(7),
    @aDate_Overture dateTime,
	@adminId UNIQUEIDENTIFIER
AS
BEGIN
	DECLARE @aId_announce UNIQUEIDENTIFIER = NEWID();
    BEGIN 
        IF EXISTS (SELECT 1 FROM ANNONCES WHERE Numero = @aNumero and Status = 1 and Id_Operation = @aId_Operation )
        BEGIN
            RETURN 1002;
        END
        ELSE
        BEGIN
            INSERT INTO ANNONCES(Id,Id_Operation,Numero,Date_Publication, Journal,Delai,Heure_Ouverture,Date_Overture,Status,adminId)
            VALUES (@aId_announce,@aId_Operation,@aNumero,@aDate_Publication, @aJournal, @aDelai, @aHeure_Ouverture, @aDate_Overture, 1, @adminId);
            RETURN 0;
        END
    END
    BEGIN 
        RETURN 5000;
    END 
END
